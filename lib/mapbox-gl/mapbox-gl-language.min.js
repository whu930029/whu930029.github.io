<<<<<<< HEAD
function MapboxLanguage(e){if(e=Object.assign({},e),!(this instanceof MapboxLanguage))throw new Error("MapboxLanguage needs to be called with the new keyword");this.setLanguage=this.setLanguage.bind(this),this._initialStyleUpdate=this._initialStyleUpdate.bind(this),this._defaultLanguage=e.defaultLanguage,this._isLanguageField=e.languageField||/^\{name/,this._getLanguageField=e.getLanguageField||function(e){return e==="mul"?"{name}":"{name_"+e+"}"},this._languageSource=e.languageSource||null,this._languageTransform=e.languageTransform||function(e,t){return t==="ar"?noSpacing(e):standardSpacing(e)},this._excludedLayerIds=e.excludedLayerIds||[],this.supportedLanguages=e.supportedLanguages||["ar","en","es","fr","de","ja","ko","mul","pt","ru","zh"]}function standardSpacing(e){var t=e.layers.map(function(e){if(!(e.layout||{})["text-field"])return e;var t=0;return e["source-layer"]==="state_label"&&(t=.15),e["source-layer"]==="marine_label"&&(/-lg/.test(e.id)&&(t=.25),/-md/.test(e.id)&&(t=.15),/-sm/.test(e.id)&&(t=.1)),e["source-layer"]==="place_label"&&(/-suburb/.test(e.id)&&(t=.15),/-neighbour/.test(e.id)&&(t=.1),/-islet/.test(e.id)&&(t=.01)),e["source-layer"]==="airport_label"&&(t=.01),e["source-layer"]==="rail_station_label"&&(t=.01),e["source-layer"]==="poi_label"&&/-scalerank/.test(e.id)&&(t=.01),e["source-layer"]==="road_label"&&(/-label-/.test(e.id)&&(t=.01),/-shields/.test(e.id)&&(t=.05)),Object.assign({},e,{layout:Object.assign({},e.layout,{'text-letter-spacing':t})})});return Object.assign({},e,{layers:t})}function noSpacing(e){var t=e.layers.map(function(e){if(!(e.layout||{})["text-field"])return e;var t=0;return Object.assign({},e,{layout:Object.assign({},e.layout,{'text-letter-spacing':t})})});return Object.assign({},e,{layers:t})}function isNameStringField(t,e){return typeof e=="string"&&t.test(e)}function isNameFunctionField(t,e){return e.stops&&e.stops.filter(function(e){return t.test(e[1])}).length>0}function adaptPropertyLanguage(t,e,n){if(isNameStringField(t,e))return n;if(isNameFunctionField(t,e)){var s=e.stops.map(function(e){return t.test(e[1])?[e[0],n]:e});return Object.assign({},e,{stops:s})}return e}function changeLayerTextProperty(t,e,n,s){return e.layout&&e.layout["text-field"]&&s.indexOf(e.id)===-1?Object.assign({},e,{layout:Object.assign({},e.layout,{'text-field':adaptPropertyLanguage(t,e.layout["text-field"],n)})}):e}function findStreetsSource(e){var t=Object.keys(e.sources).filter(function(t){var n=e.sources[t];return/mapbox-streets-v\d/.test(n.url)});return t[0]}MapboxLanguage.prototype.setLanguage=function(e,t){if(this.supportedLanguages.indexOf(t)<0)throw new Error("Language "+t+" is not supported");var n=this._languageSource||findStreetsSource(e),s,o,i,a,r;return n?(s=this._getLanguageField(t),o=this._isLanguageField,i=this._excludedLayerIds,a=e.layers.map(function(e){return e.source===n?changeLayerTextProperty(o,e,s,i):e}),r=Object.assign({},e,{layers:a}),this._languageTransform(r,t)):e},MapboxLanguage.prototype._initialStyleUpdate=function(){var e=this._map.getStyle(),t=this._defaultLanguage||browserLanguage(this.supportedLanguages);this._map.off("styledata",this._initialStyleUpdate),this._map.setStyle(this.setLanguage(e,t))};function browserLanguage(s){var t=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,n=t.split("-"),e=t;return n.length>1&&(e=n[0]),s.indexOf(e)>-1?e:null}MapboxLanguage.prototype.onAdd=function(e){return this._map=e,this._map.on("styledata",this._initialStyleUpdate),this._container=document.createElement("div"),this._container},MapboxLanguage.prototype.onRemove=function(){this._map.off("styledata",this._initialStyleUpdate),this._map=void 0};function ie11Polyfill(){typeof Object.assign!="function"&&Object.defineProperty(Object,"assign",{value:function(s){'use strict';if(s===null)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(s),e,t,n=1;n<arguments.length;n++)if(e=arguments[n],e!==null)for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(o[t]=e[t]);return o},writable:!0,configurable:!0})}typeof module!="undefined"&&typeof module.exports!="undefined"?module.exports=MapboxLanguage:(ie11Polyfill(),window.MapboxLanguage=MapboxLanguage)
=======
function MapboxLanguage(a){if(a=Object.assign({},a),!(this instanceof MapboxLanguage))throw new Error('MapboxLanguage needs to be called with the new keyword');this.setLanguage=this.setLanguage.bind(this),this._initialStyleUpdate=this._initialStyleUpdate.bind(this),this._defaultLanguage=a.defaultLanguage,this._isLanguageField=a.languageField||/^\{name/,this._getLanguageField=a.getLanguageField||function(a){return a==='mul'?'{name}':'{name_'+a+'}'},this._languageSource=a.languageSource||null,this._languageTransform=a.languageTransform||function(a,b){return b==='ar'?noSpacing(a):standardSpacing(a)},this._excludedLayerIds=a.excludedLayerIds||[],this.supportedLanguages=a.supportedLanguages||['ar','en','es','fr','de','ja','ko','mul','pt','ru','zh']}function standardSpacing(a){var b=a.layers.map(function(a){if(!(a.layout||{})['text-field'])return a;var b=0;return a['source-layer']==='state_label'&&(b=.15),a['source-layer']==='marine_label'&&(/-lg/.test(a.id)&&(b=.25),/-md/.test(a.id)&&(b=.15),/-sm/.test(a.id)&&(b=.1)),a['source-layer']==='place_label'&&(/-suburb/.test(a.id)&&(b=.15),/-neighbour/.test(a.id)&&(b=.1),/-islet/.test(a.id)&&(b=.01)),a['source-layer']==='airport_label'&&(b=.01),a['source-layer']==='rail_station_label'&&(b=.01),a['source-layer']==='poi_label'&&/-scalerank/.test(a.id)&&(b=.01),a['source-layer']==='road_label'&&(/-label-/.test(a.id)&&(b=.01),/-shields/.test(a.id)&&(b=.05)),Object.assign({},a,{layout:Object.assign({},a.layout,{'text-letter-spacing':b})})});return Object.assign({},a,{layers:b})}function noSpacing(a){var b=a.layers.map(function(a){if(!(a.layout||{})['text-field'])return a;var b=0;return Object.assign({},a,{layout:Object.assign({},a.layout,{'text-letter-spacing':b})})});return Object.assign({},a,{layers:b})}function isNameStringField(b,a){return typeof a=='string'&&b.test(a)}function isNameFunctionField(b,a){return a.stops&&a.stops.filter(function(a){return b.test(a[1])}).length>0}function adaptPropertyLanguage(b,a,c){if(isNameStringField(b,a))return c;if(isNameFunctionField(b,a)){var d=a.stops.map(function(a){return b.test(a[1])?[a[0],c]:a});return Object.assign({},a,{stops:d})}return a}function changeLayerTextProperty(b,a,c,d){return a.layout&&a.layout['text-field']&&d.indexOf(a.id)===-1?Object.assign({},a,{layout:Object.assign({},a.layout,{'text-field':adaptPropertyLanguage(b,a.layout['text-field'],c)})}):a}function findStreetsSource(a){var b=Object.keys(a.sources).filter(function(b){var c=a.sources[b];return/mapbox-streets-v\d/.test(c.url)});return b[0]}MapboxLanguage.prototype.setLanguage=function(a,b){var c,d,e,f,g,h;if(this.supportedLanguages.indexOf(b)<0)throw new Error('Language '+b+' is not supported');return c=this._languageSource||findStreetsSource(a),!c?a:(d=this._getLanguageField(b),e=this._isLanguageField,f=this._excludedLayerIds,g=a.layers.map(function(a){return a.source===c?changeLayerTextProperty(e,a,d,f):a}),h=Object.assign({},a,{layers:g}),this._languageTransform(h,b))},MapboxLanguage.prototype._initialStyleUpdate=function(){var a=this._map.getStyle(),b=this._defaultLanguage||browserLanguage(this.supportedLanguages);this._map.off('styledata',this._initialStyleUpdate),this._map.setStyle(this.setLanguage(a,b))};function browserLanguage(d){var b=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,c=b.split('-'),a=b;return c.length>1&&(a=c[0]),d.indexOf(a)>-1?a:null}MapboxLanguage.prototype.onAdd=function(a){return this._map=a,this._map.on('styledata',this._initialStyleUpdate),this._container=document.createElement('div'),this._container},MapboxLanguage.prototype.onRemove=function(){this._map.off('styledata',this._initialStyleUpdate),this._map=void 0};function ie11Polyfill(){typeof Object.assign!='function'&&Object.defineProperty(Object,'assign',{value:function(e,f){'use strict';var d,c,a,b;if(e===null)throw new TypeError('Cannot convert undefined or null to object');d=Object(e);for(c=1;c<arguments.length;c++)if(a=arguments[c],a!==null)for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&(d[b]=a[b]);return d},writable:!0,configurable:!0})}typeof module!='undefined'&&typeof module.exports!='undefined'?module.exports=MapboxLanguage:(ie11Polyfill(),window.MapboxLanguage=MapboxLanguage)
>>>>>>> f49976ef1554371e129e9f7f937747752635a94b
